document.addEventListener("DOMContentLoaded",()=>{typeof Alpine<"u"?o():document.addEventListener("alpine:init",o)});function o(){Alpine.store("modal",{mostrar:!1,items:[],categoriaActiva:"todas",busqueda:"",productos:[],categorias:[],onConfirm:null,get total(){return this.items.reduce((t,i)=>t+i.cantidad*i.precio,0)},get cantidadTotal(){return this.items.reduce((t,i)=>t+i.cantidad,0)},get productosFiltrados(){let t=this.productos;if(this.categoriaActiva!=="todas"&&(t=t.filter(i=>i.categoria_id==this.categoriaActiva)),this.busqueda.trim()){const i=this.busqueda.toLowerCase();t=t.filter(e=>e.nombre.toLowerCase().includes(i)||(e.categoria?.nombre||"").toLowerCase().includes(i))}return t},abrir(t,i,e){console.log("Abriendo modal con:",{productos:t?.length,categorias:i?.length}),this.productos=t||[],this.categorias=i||[],this.onConfirm=e,this.mostrar=!0,document.body.style.overflow="hidden"},cerrar(){this.mostrar=!1,this.busqueda="",this.categoriaActiva="todas",document.body.style.overflow="auto"},confirmar(){if(this.items.length===0){alert("Selecciona al menos un producto");return}this.onConfirm&&this.onConfirm(this.items),this.cerrar()},esSeleccionado(t){return this.items.some(i=>i.producto_id===t)},getCantidad(t){const i=this.items.find(e=>e.producto_id===t);return i?i.cantidad:0},toggleProducto(t){this.items.find(e=>e.producto_id===t.id)?this.eliminarProducto(t.id):this.agregarProducto(t)},agregarProducto(t){this.items.push({producto_id:t.id,nombre:t.nombre,precio:parseFloat(t.precio),imagen:t.imagen,cantidad:1})},eliminarProducto(t){const i=this.items.findIndex(e=>e.producto_id===t);i!==-1&&this.items.splice(i,1)},cambiarCantidad(t,i){const e=this.items.find(s=>s.producto_id===t);e&&(e.cantidad+=i,e.cantidad<=0&&this.eliminarProducto(t))},limpiarCarrito(){this.items=[]},setItems(t){this.items=Array.isArray(t)?[...t]:[]}})}
